p_hat[subject_0] * 10
source("~/Documents/epidemic_modelling/r/solvers/cvx_solver.R")
print(lambda)
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm="inf")
p_hat[which(p_hat <0)]=0
p_hat[which(abs(p_hat) <1e-10)]=0
p_hat[neighbors]
p_hat[subject_0]
p_hat
p_hat[which(abs(p_hat) <1e-7)]=0
p_hat
neighbors <- as.numeric(neighborhood(g, nodes = c(subject_0), mindist=1)[[1]])
p_hat[neighbors]
neighbors
library(tidyverse)
library(igraph)
source("graph_utils.R")
source("experiments/evaluate_solution.R")
source("experiments/simulate_epidemic.R")
source("r/solvers/cvx_solver.R")
# Parameters
args <- commandArgs(trailingOnly = TRUE)
source("~/Documents/epidemic_modelling/debug_params.R")
# Create random graph
g <- sample_pa(n, power = power_pa, directed = FALSE)
if (do_plot) {
layout <- layout_with_fr(g)
plot(g, layout = layout, vertex.size = 4,
edge.arrow.size = 0, vertex.label = NA)
}
# Assign initial patients
y_init <- rep(0, n)
subject_0 <- sample(1:n, nb_init)
y_init[subject_0] <- 1
# Record statistics on the initial patients
d <- degree(g, v = subject_0,
mode = "total", loops = TRUE,
normalized = FALSE)
btw <- betweenness(g, v = subject_0)
cls <- closeness(g, v = subject_0)
d
neighbors <- as.numeric(neighborhood(g, nodes = c(subject_0), mindist=1)[[1]])
neighbors
print(neighbors)
graph_attributes$W[subject_0, neighbors]
state <- simulate_epidemic(graph_attributes$W,
y_init = y_init,
beta = beta_epid,
gamma = gamma_epid,
steps = steps,
heterogeneity_rates = heterogeneity_rates)
state
graph_attributes <- get_edge_incidence(g, state$beta_v, graph = "PA", weight=1)
graph_attributes
graph_attributes$W[subject_0, neighbors]
lambda = 0.01
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm="inf")
p_hat
p_hat[which(p_hat <0)]=0
p_hat[which(abs(p_hat) <1e-7)]=0
p_hat[neighbors]
p_hat[subject_0]
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm=1)
p_hat[which(p_hat <0)]=0
p_hat[which(abs(p_hat) <1e-7)]=0
p_hat[neighbors]
p_hat[subject_0]
res_temp <- evaluate_solution(state$y_observed,
p_hat,
state$true_p,
graph_attributes$Gamma)
p_hat[which(p_hat <0)]=0
p_hat[which(abs(p_hat) <1e-7)]=0
lambda =0.0001
p_norm = "inf"
print(lambda)
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm=p_norm)
lambda
lambda = 1e-3
print(lambda)
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm=p_norm)
p_norm = "inf"
print(lambda)
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm=p_norm)
graph_attributes$Gamma
lambda = 0.01
p_hat <- cvx_solver(y_init,
graph_attributes$Gamma,
lambda, p_norm=p_norm)
p_hat[which(p_hat <0)]=0
p_hat[which(abs(p_hat) <1e-7)]=0
p_hat[neighbors]
p_hat[subject_0]
p_hat
neighbors2 <- as.numeric(neighborhood(g, order=2, nodes = c(subject_0), mindist=2)[[1]])
neighbors2
p_hat[neighbors2]
p_hat[neighbors]
p_hat[neighbors2]
p_hat[subject_0]
lambda
e
# Propagate solution
prop_sol <- propagate_solution(graph_attributes$W, p_hat, state$beta_v,
state$gamma_v, 20)
prop_sol
propagate_solution <- function(W, p_hat, beta_v, gamma_v, nb_steps) {
p_current <- p_hat
list_p <- vector("list", nb_steps)
for (it in 1:nb_steps){
prop_results <- propagate_one_step(W, as.numeric(p_current), beta_v, gamma_v)
p_current <- sapply(prop_results$true_p, function(x){min(max(x,0), 1)})
list_p[[it]] <- p_current
}
return(list_p)
}
# Propagate solution
prop_sol <- propagate_solution(graph_attributes$W, p_hat, state$beta_v,
state$gamma_v, 20)
prop_sol
# Propagate real data
prop_truth <- propagate_solution(graph_attributes$W, y_init,
state$beta_v, state$gamma_v, 20)
prop_truth
# Compare the two
for (it in 1:20){
res_temp[ paste0("l1_propagated_error_", it)] = mean(abs(prop_truth[[it]] - prop_sol[[it]]))
res_temp[ paste0("l2_propagated_error_", it)] = mean((prop_truth[[it]] - prop_sol[[it]])^2)
}
res_temp
library(tidyverse)
setwd("~/Documents/epidemic_modelling/experiments/results/pa_graph/")
setwd("~/Documents/epidemic_modelling/experiments/results/pa_graph/")
theme_set(theme_bw(base_size = 14))
folder_path <- "~/Documents/epidemic_modelling/experiments/results/pa_graph/"
file_list <- list.files(folder_path, full.names = TRUE)
file_list
file_list <- list.files(folder_path, pattern = "^9", full.names = TRUE)
#file_list <- c(file_list, list.files(folder_path, pattern = "^759", full.names = TRUE))
# Read all the files into a single data frame using map_dfr.
data <- map_dfr(file_list, read_csv)  # Assuming your files are CSV files. Adjust the function accordingly if they are different file types.
dim(data)
colnames(data)
unique(data$exp)
data_list <- lapply(file_list, function(file) {
data <- read.csv(file, stringsAsFactors = FALSE)
data$filename <- file
return(data)
})
# Combine all individual data frames into one data frame
data <- do.call(rbind, data_list)
colnames(data)
#### first group by experiment
res  = data %>%
group_by(filename, lambda, beta_epid, gamma_epid, n, power_pa, steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
dim(res)
###
res_all  = res %>%
select(-c("filename")) %>%
group_by(lambda, beta_epid, gamma_epid, n, power_pa, steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
res$heterogeneity_rates
res %>%
select(-c("filename"))
###
res_all  = res %>%
select(-c(`filename`)) %>%
group_by(lambda, beta_epid, gamma_epid, n, power_pa, steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
res %>%
select(-c(`filename`))
res %>%
select(-`filename`)
###
res_all  = res %>%
select(-`filename`) %>%
group_by(lambda, beta_epid, gamma_epid, n, power_pa, steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
res %>%
select(-`filename`)
res %>%
select(-filename)
res %>%
select(-`filename`)
res %>% ungroup() %>%
select(-`filename`)
###
res_all  = res %>%
ungroup() %>%
select(-`filename`) %>%
group_by(lambda, beta_epid, gamma_epid, n, power_pa, steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
res_all
dim(res_all)
unique(res_all$lambda)
unique(res_all$power_pa)
unique(res_all$p_norm)
unique(res_all$beta_epid)
colnames(res_all)
unique(res_all$nb_init)
ggplot(res_all %>% filter(power_pa==1), aes(x=lambda, l1_error))+
geom_line()+
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2), aes(x=lambda, l1_error))+
geom_line()+
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l1_error))+
geom_line()+
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l1_error))+
geom_line()+
scale_x_log10()+
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 10), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 10), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l1_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
facet_wrap(beta_epid/gamma_epid~p_norm)
colnames(res_all)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1), aes(x=lambda, l2_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1),
aes(x=lambda, risk_observed))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1),
aes(x=lambda, risk_observed))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1),
aes(x=lambda, l1_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
library(tidyverse)
setwd("~/Documents/epidemic_modelling/experiments/results/er_graph/")
theme_set(theme_bw(base_size = 14))
folder_path <- "~/Documents/epidemic_modelling/experiments/results/er_graph/"
file_list <- list.files(folder_path, pattern = "^9", full.names = TRUE)
#file_list <- c(file_list, list.files(folder_path, pattern = "^759", full.names = TRUE))
# Read all the files into a single data frame using map_dfr.
data <- map_dfr(file_list, read_csv)
#file_list <- c(file_list, list.files(folder_path, pattern = "^759", full.names = TRUE))
# Read all the files into a single data frame using map_dfr.
#data <- map_dfr(file_list, read_csv)
data_list <- lapply(file_list, function(file) {
data <- read.csv(file, stringsAsFactors = FALSE)
data$filename <- file
return(data)
})
# Combine all individual data frames into one data frame
data <- do.call(rbind, data_list)
colnames(data)
colnames(data)
#### first group by experiment
res  = data %>%
group_by(filename, lambda, beta_epid, gamma_epid, n, proba_er,
steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
###
res_all  = res %>%
ungroup() %>%
select(-`filename`) %>%
group_by(lambda, beta_epid, gamma_epid, n, proba_er,
steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
dim(res_all)
unique(res_all$lambda)
unique(res_all$power_pa)
unique(res_all$proba_er)
unique(res_all$beta_epid)
ggplot(res_all %>% filter(power_pa==1.2,
nb_init == 1),
aes(x=lambda, l1_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
ggplot(res_all %>% filter(
nb_init == 1),
aes(x=lambda, l1_error))+
geom_line()+
scale_x_log10()+
scale_y_log10() +
geom_hline(aes(yintercept = oracle )) +
facet_wrap(beta_epid/gamma_epid~p_norm)
library(tidyverse)
setwd("~/Documents/epidemic_modelling/experiments/results/")
theme_set(theme_bw(base_size = 14))
folder_path <- "~/Documents/epidemic_modelling/experiments/results/dcsbm_graph/"
file_list <- list.files(folder_path, pattern = "^9", full.names = TRUE)
#file_list <- c(file_list, list.files(folder_path, pattern = "^759", full.names = TRUE))
# Read all the files into a single data frame using map_dfr.
#data <- map_dfr(file_list, read_csv)
data_list <- lapply(file_list, function(file) {
data <- read.csv(file, stringsAsFactors = FALSE)
data$filename <- file
return(data)
})
# Combine all individual data frames into one data frame
data <- do.call(rbind, data_list)
colnames(data)
#### first group by experiment
res  = data %>%
group_by(filename, lambda, beta_epid, gamma_epid, n, proba_er,
steps, heterogeneity_rates, nb_init, p_norm) %>%
summarise_all(mean)
file_list <- list.files(path = "~/Documents/group-CCA/experiments/sparse_CCA/results/",
pattern = "new_exp_97*", full.names = TRUE)
# Read and combine CSV files into a single data frame
results <- file_list %>%
map_dfr(~ read_csv(.x) %>% mutate(filename = .x)) %>%
mutate("selection" = ifelse(str_detect(filename, "correlation"), "correlation", "prediction"))
library(tidyverse)
file_list <- list.files(path = "~/Documents/group-CCA/experiments/sparse_CCA/results/",
pattern = "new_exp_97*", full.names = TRUE)
# Read and combine CSV files into a single data frame
results <- file_list %>%
map_dfr(~ read_csv(.x) %>% mutate(filename = .x)) %>%
mutate("selection" = ifelse(str_detect(filename, "correlation"), "correlation", "prediction"))
##### Analyse this data
res = results %>%
mutate(FDR=1 - nb_real_discoveries/max(1,nb_discoveries)) %>%
group_by(method, selection, criterion, n, nnz, p1, p2, r, r_pca,
overlapping_amount) %>%
summarise_if(is.numeric, median) %>%
arrange(n, nnz, p1, p2, distance_tot)
t = as.numeric(sapply(res$method, function(x){ifelse(str_count(x, "folds" )>0, 1, 0)}))
t = t  + as.numeric(sapply(res$method, function(x){ifelse(str_count(x, "CV" )>0, 2, 0)}))
res["shape"] = as.factor(t)
legend_order <- c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope", "lasso_Selection",   "Fantope" ,
"thresholded-lasso",
"Canonical Ridge-Author",
"FIT_SAR_BIC", "FIT_SAR_CV", "SCCA_Parkhomenko",
"Witten_Perm", "Witten.CV", "Waaijenborg-Author",
"Waaijenborg-CV", "Selection",  "Oracle" )
my_colors <- c( "gray", "black",
"dodgerblue", "cyan",  "red","orange","orange4","navy", "grey", "yellow",
"green", "green3", "navajowhite3", "plum2", "plum3",
"cadetblue1", "lightskyblue", "brown", "beige","whitesmoke", "white")
unique(res$n)
unique(res$nnz)
unique(res$overlapping_amount)
ggplot(res )+
geom_line(aes(x=overlapping_amount, y=distance_tot, colour=method), linewidth=1.)+
geom_point(aes(x=overlapping_amount, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values = my_colors, breaks = legend_order) +
facet_grid(n~nnz, scales="free") +
theme_bw()
ggplot(res %>%filter( method %in% c("SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")))+
geom_line(aes(x=overlapping_amount, y=distance_tot, colour=method), linewidth=1.)+
geom_point(aes(x=overlapping_amount, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values =  c(
"dodgerblue", "cyan",   "plum2", "plum3", "red","orange","navy", "orange4","black"),
breaks = c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")) +
facet_grid(n~nnz, scales="free") +
theme_bw()
ggplot(res %>%filter( method %in% c("SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle"), n==400))+
geom_line(aes(x=p1/n, y=distance_tot, colour=method), linewidth=1.)+
#geom_point(aes(x=p1/n, y=distance_tot, colour=method), size=2.2)+
geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values =  c(
"dodgerblue", "cyan",   "plum2", "plum3", "red","orange","navy", "orange4","black"),
breaks = c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")) +
facet_grid(overlapping_amount~nnz, scales="free") +
theme_bw()
ggplot(res %>%filter( method %in% c("SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle"), n==400))+
geom_line(aes(x=p1/n, y=distance_tot, colour=method), linewidth=1.)+
#geom_point(aes(x=p1/n, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values =  c(
"dodgerblue", "cyan",   "plum2", "plum3", "red","orange","navy", "orange4","black"),
breaks = c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")) +
facet_grid(overlapping_amount~nnz, scales="free") +
theme_bw()
ggplot(res %>%filter( method %in% c("SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle"), n==200))+
geom_line(aes(x=p1/n, y=distance_tot, colour=method), linewidth=1.)+
#geom_point(aes(x=p1/n, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values =  c(
"dodgerblue", "cyan",   "plum2", "plum3", "red","orange","navy", "orange4","black"),
breaks = c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")) +
facet_grid(overlapping_amount~nnz, scales="free") +
theme_bw()
ggplot(res %>% filter(method %in% c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,  "Fantope" ), selection=="prediction"))+
geom_line(aes(x=overlapping_amount, y=distance_tot, colour=method), linewidth=1.)+
geom_point(aes(x=overlapping_amount, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values = my_colors, breaks = legend_order) +
facet_grid(n~sparsity, scales="free") +
theme_bw()
ggplot(res %>%filter( method %in% c("SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle"), n==200))+
geom_line(aes(x=overlapping_amount, y=distance_tot, colour=method), linewidth=1.)+
geom_point(aes(x=overlapping_amount, y=distance_tot, colour=method), size=2.2)+
#geom_jitter(aes(x=p1/n, y=distance_tot, colour=method, shape=shape), size=2.2)+
#geom_line(data=res %>% group_by(n, nnz, p1, p2) %>% summarise(b=mean(zero_benchmark)),
#          aes(y=b, x=p1/n, colour="Zero Benchmark"), colour="black", linewidth=0.5)+
scale_color_manual(values =  c(
"dodgerblue", "cyan",   "plum2", "plum3", "red","orange","navy", "orange4","black"),
breaks = c( "SSVD-theory" ,  "SSVD-method",
"adaptive_lasso_Fantope", "adaptive_lasso_Selection",
"TG" ,"lasso_Fantope",  "Fantope" ,
"thresholded-lasso",  "Oracle")) +
facet_grid(r~r_pca, scales="free") +
theme_bw()
